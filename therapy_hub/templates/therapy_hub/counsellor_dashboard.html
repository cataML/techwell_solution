{% extends 'base_therapy.html' %}
{% load static %}
{% block title %}Techwell Therapy | Dashboard{% endblock %}

{% block content %}
<header class="bg-forest text-white py-4 text-center shadow-lg">
    <h1>Welcome, {{ request.user.first_name }} {{ request.user.last_name }} ðŸ‘‹

    </h1>
    <p>Role: <strong>{{ request.user.therapy_profile.role|title }}</strong></p>
</header>

<div class="container mx-auto py-8 px-4">

    <!-- Upcoming Sessions -->
    <div class="card mb-12 p-6 rounded-xl shadow-md">
        <h3 class="text-xl font-semibold mb-4 border-b pb-2 text-green-800">ðŸ“… Upcoming Sessions</h3>

        {% if upcoming_sessions %}
            <table class="w-full border-collapse">
                <thead>
                    <tr class="bg-gray-100 text-left">
                        <th class="py-2 px-3">Date</th>
                        <th class="py-2 px-3">Time</th>
                        <th class="py-2 px-3">Client</th>
                        <th class="py-2 px-3">Status</th>
                        <th class="py-2 px-3">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for s in upcoming_sessions %}
                    <tr class="border-b hover:bg-gray-50">
                        <td class="py-2 px-3">{{ s.date|date:"M d, Y" }}</td>
                        <td class="py-2 px-3">{{ s.time|time:"H:i A" }}</td>
                        <td class="py-2 px-3">{{ s.client.get_full_name }}</td>
                        <td class="py-2 px-3">
                            <span class="px-2 py-1 rounded text-sm {% if s.status == 'confirmed' %}bg-green-200 text-green-800{% elif s.status == 'pending' %}bg-yellow-200 text-yellow-800{% else %}bg-gray-200 text-gray-700{% endif %}">
                                {{ s.status|title }}
                            </span>
                        </td>
                        <td class="py-2 px-3">
                            <a href="{% url 'therapy_hub:view_session' s.id %}" class="text-blue-600 hover:underline">View</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p class="text-green-500">No upcoming sessions scheduled.</p>
        {% endif %}
    </div>


    <!-- My Clients -->
    <div class="card mb-12 p-3 rounded-xl shadow-md">
        <h3 class="text-xl font-semibold mb-4 border-b pb-2 text-green-800">ðŸ‘¥ My Clients</h3>

        {% if clients %}
            <ul class="space-y-2">
                {% for c in clients %}
                <li class="p-3 border rounded-lg hover:bg-gray-50 flex justify-between">
                    <div>
                        <strong>{{ c.username }}</strong>  
                        <p class="text-sm text-gray-500">Next Session: {{ c.next_session|date:"M d, Y H:i" }}</p>
                    </div>
                    <span class="px-2 py-1 text-sm rounded {% if c.status == 'active' %}bg-green-100 text-green-700{% else %}bg-gray-100 text-gray-600{% endif %}">
                        {{ c.status|title }}
                    </span>
                </li>
                {% endfor %}
            </ul>
        {% else %}
            <p class="text-gray-500">No clients assigned yet.</p>
        {% endif %}
    </div>


    <!-- Earnings Summary -->
    <div class="card p-6 rounded-xl shadow-md bg-white text-center">
        <h3 class="text-xl font-semibold mb-4 border-b pb-1 text-green-800">ðŸ’° Earnings Summary</h3>
        <p class="text-3xl font-bold text-green-700">KES {{ earnings|floatformat:2 }}</p>
        <p class="text-sm text-gray-500 mt-2">Based on completed sessions this month.</p>

        <header class="text-white py-4 text-center shadow-lg">
    <h1>Welcome, {{ request.user.first_name }} {{ request.user.last_name }} ðŸ‘‹</h1>
    <p>Role: <strong>{{ request.user.therapy_profile.role|title }}</strong></p>
</header>

<div class="container mx-auto py-8 px-4">

    <!-- Upcoming Sessions -->
    <div class="card mb-6 p-3 rounded-xl shadow-md">
        <h3 class="text-xl font-semibold mb-4 border-b pb-2">ðŸ“… Upcoming Sessions</h3>

        {% if upcoming_sessions %}
            <table class="w-full border-collapse">
                <thead>
                    <tr class="bg-gray-100 text-left">
                        <th class="py-2 px-3">Date</th>
                        <th class="py-2 px-3">Time</th>
                        <th class="py-2 px-3">Client</th>
                        <th class="py-2 px-3">Status</th>
                        <th class="py-2 px-3">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for s in upcoming_sessions %}
                    <tr class="border-b hover:bg-gray-50">
                        <td class="py-2 px-3">{{ s.date|date:"M d, Y" }}</td>
                        <td class="py-2 px-3">{{ s.time|time:"H:i A" }}</td>
                        <td class="py-2 px-3">{{ s.client.get_full_name }}</td>
                        <td class="py-2 px-3">
                            <span class="px-2 py-1 rounded text-sm {% if s.status == 'confirmed' %}bg-green-200 text-green-700{% elif s.status == 'pending' %}bg-yellow-200 text-yellow-800{% else %}bg-gray-200 text-gray-700{% endif %}">
                                {{ s.status|title }}
                            </span>
                        </td>
                        <td class="py-2 px-3">
                            <a href="{% url 'therapy_hub:view_session' s.id %}" class="text-blue-600 hover:underline">View</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p class="text-gray-500">No upcoming sessions scheduled.</p>
        {% endif %}
    </div>


    <!-- My Clients -->
    <div class="card mb-12 p-6 rounded-xl shadow-md">
        <h3 class="text-xl font-semibold mb-4 border-b pb-2 text-green-800">ðŸ‘¥ My Clients</h3>

        {% if clients %}
            <ul class="space-y-2">
                {% for c in clients %}
                <li class="p-3 border rounded-lg hover:bg-gray-50 flex justify-between">
                    <div>
                        <strong>{{ c.username }}</strong>  
                        <p class="text-sm text-gray-500">Next Session: {{ c.next_session|date:"M d, Y H:i" }}</p>
                    </div>
                    <span class="px-2 py-1 text-sm rounded {% if c.status == 'active' %}bg-green-100 text-green-700{% else %}bg-gray-100 text-gray-600{% endif %}">
                        {{ c.status|title }}
                    </span>
                </li>
                {% endfor %}
            </ul>
        {% else %}
            <p class="text-gray-500">No clients assigned yet.</p>
        {% endif %}
    </div>


    <!-- Earnings Summary -->
    <div class="card p-6 rounded-xl shadow-md bg-white text-center">
        <h3 class="text-xl font-semibold mb-4 border-b pb-2">ðŸ’° Earnings Summary</h3>
        <p class="text-3xl font-bold text-green-700">KES {{ earnings|floatformat:2 }}</p>
        <p class="text-sm text-gray-500 mt-2">Based on completed sessions this month.</p>

        <a href="{% url 'therapy_hub:earnings_report' %}" class="inline-block mt-4 hover:bg-blue-700 text-white px-4 py-2 rounded-lg shadow">
            View Detailed Report
        </a>
    </div>

</div>
    </div>

</div>
{% endblock %}